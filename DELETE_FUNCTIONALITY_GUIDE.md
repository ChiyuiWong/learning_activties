# 删除功能使用指南

## 概述

我已经为你的学习活动系统添加了完整的删除功能，包括投票系统、短问答系统和测验系统的删除功能。

## 新增功能

### 后端API端点

1. **通用活动删除**
   - `DELETE /api/learning/delete/activities/<activity_id>`
   - 支持软删除和硬删除（通过 `?hard_delete=true` 参数）

2. **投票删除**
   - `DELETE /api/learning/delete/polls/<poll_id>`
   - 删除投票及其相关投票记录

3. **短问答删除**
   - `DELETE /api/learning/delete/shortanswers/<question_id>`
   - 删除短问答问题

4. **测验删除**
   - `DELETE /api/learning/delete/quizzes/<quiz_id>`
   - 删除测验及其相关尝试记录

5. **词云删除**
   - `DELETE /api/learning/delete/wordclouds/<wordcloud_id>`
   - 删除词云活动

### 前端功能

1. **删除按钮**
   - 只有创建者可以看到删除按钮
   - 删除按钮显示在活动卡片上
   - 点击删除按钮会显示确认对话框

2. **删除确认**
   - 删除前会弹出确认对话框
   - 显示删除警告信息

3. **删除反馈**
   - 删除成功后会显示成功通知
   - 删除失败会显示错误信息
   - 删除后自动刷新页面

## 使用方法

### 1. 启动服务器

```bash
cd learning_activties/backend
python app.py
```

### 2. 访问前端

打开浏览器访问：`http://localhost:5001`

### 3. 删除活动

1. 登录系统
2. 进入"学习活动"页面
3. 在"我的活动"标签页中查看你创建的活动
4. 点击活动卡片上的删除按钮（垃圾桶图标）
5. 确认删除操作

## 安全特性

1. **权限控制**
   - 只有活动的创建者可以删除活动
   - 其他用户无法看到删除按钮

2. **数据完整性**
   - 删除活动时会同时删除相关数据（投票记录、学生提交等）
   - 支持软删除和硬删除两种模式

3. **错误处理**
   - 完善的错误处理和日志记录
   - 用户友好的错误信息

## 测试删除功能

运行测试脚本：

```bash
cd learning_activties
python test_delete_functionality.py
```

## 技术实现

### 后端实现

1. **删除路由** (`delete_routes.py`)
   - 实现了所有活动类型的删除端点
   - 包含权限验证和错误处理

2. **服务层** (`services.py`)
   - `delete_activity()` 方法支持软删除和硬删除
   - 自动清理相关数据

3. **路由注册** (`routes.py`)
   - 将删除路由注册到主路由中

### 前端实现

1. **JavaScript功能** (`learning-activities.js`)
   - `deleteActivity()` 方法处理删除逻辑
   - 动态显示删除按钮（仅对创建者可见）
   - 删除确认和反馈

2. **UI更新**
   - 活动卡片上添加删除按钮
   - 删除后自动刷新视图

## 注意事项

1. **数据备份**
   - 删除操作不可逆，建议在生产环境中启用软删除
   - 重要数据建议先备份

2. **权限管理**
   - 确保只有授权用户可以删除活动
   - 考虑添加管理员权限

3. **性能考虑**
   - 大量数据删除可能影响性能
   - 考虑异步删除处理

## 故障排除

### 常见问题

1. **删除按钮不显示**
   - 检查用户是否为活动创建者
   - 确认前端JavaScript正确加载

2. **删除失败**
   - 检查网络连接
   - 查看浏览器控制台错误信息
   - 确认服务器日志

3. **权限错误**
   - 确认用户已登录
   - 检查JWT令牌是否有效

### 调试方法

1. **查看浏览器控制台**
   - 打开开发者工具
   - 查看Network标签页的请求
   - 查看Console标签页的错误信息

2. **查看服务器日志**
   - 检查后端日志输出
   - 确认数据库连接正常

## 扩展功能

可以考虑添加以下功能：

1. **批量删除**
   - 支持选择多个活动进行批量删除

2. **删除历史**
   - 记录删除操作历史
   - 支持恢复已删除的活动

3. **删除确认增强**
   - 显示将要删除的相关数据数量
   - 更详细的删除警告信息

4. **管理员功能**
   - 管理员可以删除任何活动
   - 强制删除功能

## 联系支持

如果遇到问题，请检查：
1. 服务器是否正常运行
2. 数据库连接是否正常
3. 前端JavaScript是否正确加载
4. 用户权限是否正确设置
