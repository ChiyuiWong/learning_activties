<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <meta name="translate" content="no">
    <title>COMP5241 Group 10 - Learning Management System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="static/css/main.css">
    <link rel="stylesheet" href="static/css/components.css">
    <link rel="stylesheet" href="static/css/notifications.css">
    <link rel="stylesheet" href="static/css/quiz.css">
    <style>
        .notranslate {
            translate: no !important;
        }
        .word-item {
            translate: no !important;
        }
        .word-cloud {
            translate: no !important;
        }
    </style>
</head>
<body class="notranslate">
    <!-- Navigation Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" id="navbar-brand">
                <span class="fw-bold">COMP5241 LMS</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="dashboard">
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="courses">
                            Courses
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="activities">
                            Activities
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="genai">
                            AI Assistant
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <span id="user-name">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow">
                            <li><a class="dropdown-item" href="#" id="nav-profile">
                                Profile
                            </a></li>
                            <li><a class="dropdown-item" href="#" id="nav-settings">
                                Settings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" id="nav-logout">
                                Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-light me-2" href="/login.html">
                            <i class="bi bi-person-circle"></i> Login
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Alert Container -->
    <div id="alertContainer" class="container-fluid mt-3">
        <!-- Alerts will be dynamically inserted here -->
    </div>
    
    <!-- Authentication Status Banner -->
    <div class="container-fluid">
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="bi bi-info-circle"></i>
            <strong>Authentication Notice:</strong> This system requires login to use learning activity features.
            <a href="/login.html" class="alert-link">Click here to login</a>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-key"></i>
            <strong>Demo Accounts:</strong> 
            Teacher: <code>teacher1 / password123</code> | 
            Student: <code>student1 / password123</code> | 
            Any Username: <code>any_username / demo</code>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Sidebar (for navigation) -->
            <div class="col-lg-3 col-md-4">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-header bg-primary text-white rounded-top-4 border-0">
                        <h6 class="mb-0 fw-semibold">
                            Quick Navigation
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action py-3 active" data-section="dashboard">
                                <span class="fw-medium">Dashboard</span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action py-3" data-section="courses">
                                <span class="fw-medium">My Courses</span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action py-3" data-section="activities">
                                <span class="fw-medium">Learning Activities</span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action py-3" data-section="genai">
                                <span class="fw-medium">AI Assistant</span>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action py-3" data-section="admin">
                                <span class="fw-medium">Admin Panel</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <div id="main-content">
                    <!-- Dashboard Section -->
                    <div id="dashboard-section" class="content-section">
                        <div class="mb-4">
                            <h2 class="mb-0 fw-bold">Dashboard</h2>
                            <p class="text-muted mb-0">Welcome to your learning dashboard</p>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-lg-8">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4">
                                        <div class="mb-3">
                                            <h5 class="card-title mb-0 fw-semibold">Welcome Back!</h5>
                                        </div>
                                        <p class="card-text text-muted mb-4">This is your learning dashboard. Navigate through the sections to access different features and manage your educational journey.</p>
                                        <div class="row g-3">
                                            <div class="col-6">
                                                <div class="bg-light rounded-3 p-3 text-center">
                                                    <small class="text-muted">Active Courses</small>
                                                    <div class="fw-bold text-dark">5</div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="bg-light rounded-3 p-3 text-center">
                                                    <small class="text-muted">Achievements</small>
                                                    <div class="fw-bold text-dark">12</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4">
                                        <div class="mb-3">
                                            <h5 class="card-title mb-0 fw-semibold">Quick Stats</h5>
                                        </div>
                                        <div class="space-y-3">
                                            <div class="d-flex justify-content-between align-items-center py-2">
                                                <span class="text-muted">Enrolled Courses:</span>
                                                <span class="fw-semibold text-primary" id="enrolled-courses-count">5</span>
                                            </div>
                                            <hr class="my-2">
                                            <div class="d-flex justify-content-between align-items-center py-2">
                                                <span class="text-muted">Pending Activities:</span>
                                                <span class="fw-semibold text-warning" id="pending-activities-count">3</span>
                                            </div>
                                            <hr class="my-2">
                                            <div class="d-flex justify-content-between align-items-center py-2">
                                                <span class="text-muted">Completed Activities:</span>
                                                <span class="fw-semibold text-success" id="completed-activities-count">28</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Courses Section (Keith's responsibility) -->
                    <div id="courses-section" class="content-section d-none">
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <div>
                                <h2 class="mb-0 fw-bold">Courses</h2>
                                <p class="text-muted mb-0">Manage your learning courses</p>
                            </div>
                            <button class="btn btn-primary btn-lg rounded-pill px-4" id="create-course-btn">
                                Create New Course
                            </button>
                        </div>
                        
                        <div class="card border-0 shadow-sm rounded-4">
                            <div class="card-body p-4">
                                <div id="courses-list" class="text-center py-5">
                                    <div class="spinner-border text-primary mb-3" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="text-muted">Loading courses... (To be implemented by Keith)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Activities Section (Charlie's responsibility) -->
                    <div id="activities-section" class="content-section d-none">
                        <!-- Role-based content will be dynamically loaded here -->
                        <div id="role-based-activities-content">
                            <!-- Content will be dynamically generated based on user role -->
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary mb-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted">Loading activities based on your role...</p>
                            </div>
                        </div>
                    </div>

                    <!-- GenAI Section (Ting's responsibility) -->
                    <div id="genai-section" class="content-section d-none">
                        <div class="mb-4">
                            <h2 class="mb-0 fw-bold">AI Assistant</h2>
                            <p class="text-muted mb-0">Intelligent content generation and support powered by Ollama</p>
                        </div>
                        
                        <div class="row g-4">
                            <!-- AI Chat Assistant -->
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm rounded-4 h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="card-body text-white p-4 d-flex flex-column">
                                        <div class="mb-3">
                                            <i class="bi bi-chat-dots display-4"></i>
                                        </div>
                                        <h5 class="card-title fw-bold mb-2">Chat Assistant</h5>
                                        <p class="card-text mb-4">Have conversations with AI models to get help with your coursework, ask questions, and get instant feedback.</p>
                                        <a href="ai-assistant.html" class="btn btn-light rounded-pill px-4 fw-medium mt-auto">
                                            Open Chat
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Models -->
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4 d-flex flex-column">
                                        <div class="mb-3">
                                            <i class="bi bi-cpu display-4 text-primary"></i>
                                        </div>
                                        <h5 class="card-title fw-bold mb-2">AI Models</h5>
                                        <p class="card-text mb-4">Download and manage AI models like llama2, mistral, and codellama for different purposes.</p>
                                        <a href="ai-assistant.html#models" class="btn btn-outline-primary rounded-pill px-4 fw-medium mt-auto">
                                            Manage Models
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Course Materials -->
                            <div class="col-lg-4">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4 d-flex flex-column">
                                        <div class="mb-3">
                                            <i class="bi bi-files display-4 text-success"></i>
                                        </div>
                                        <h5 class="card-title fw-bold mb-2">Course Materials</h5>
                                        <p class="card-text mb-4">Upload course materials (PDF, DOCX, TXT) for context-aware AI responses.</p>
                                        <a href="ai-assistant.html#materials" class="btn btn-outline-success rounded-pill px-4 fw-medium mt-auto">
                                            Upload Materials
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Features Overview -->
                        <div class="card border-0 shadow-sm rounded-4 mt-4">
                            <div class="card-header bg-light border-0 py-3">
                                <h5 class="mb-0 fw-semibold"><i class="bi bi-star"></i> Features</h5>
                            </div>
                            <div class="card-body p-4">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
                                                <i class="bi bi-lightning text-primary fs-5"></i>
                                            </div>
                                            <div>
                                                <h6 class="fw-semibold mb-1">Real-time Conversations</h6>
                                                <p class="text-muted small mb-0">Chat with AI models in real-time with instant responses</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                                                <i class="bi bi-book text-success fs-5"></i>
                                            </div>
                                            <div>
                                                <h6 class="fw-semibold mb-1">Context-Aware Responses</h6>
                                                <p class="text-muted small mb-0">Get answers based on your uploaded course materials</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <div class="bg-info bg-opacity-10 rounded-circle p-3 me-3">
                                                <i class="bi bi-collection text-info fs-5"></i>
                                            </div>
                                            <div>
                                                <h6 class="fw-semibold mb-1">Multiple Models</h6>
                                                <p class="text-muted small mb-0">Choose from various AI models for different tasks</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <div class="bg-warning bg-opacity-10 rounded-circle p-3 me-3">
                                                <i class="bi bi-lock text-warning fs-5"></i>
                                            </div>
                                            <div>
                                                <h6 class="fw-semibold mb-1">Privacy First</h6>
                                                <p class="text-muted small mb-0">All AI processing happens locally with Ollama</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Start Guide -->
                        <div class="alert alert-info border-0 rounded-4 mt-4" role="alert">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-info-circle fs-4 me-3"></i>
                                <div>
                                    <h6 class="fw-semibold mb-2">Quick Start Guide</h6>
                                    <ol class="mb-0 ps-3">
                                        <li>Install Ollama from <a href="https://ollama.ai" target="_blank" class="alert-link">ollama.ai</a></li>
                                        <li>Run <code>ollama serve</code> in your terminal</li>
                                        <li>Open the <a href="ai-assistant.html" class="alert-link">AI Assistant</a></li>
                                        <li>Download a model and start chatting!</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Section (Sunny's responsibility) -->
                    <div id="admin-section" class="content-section d-none">
                        <div class="mb-4">
                            <h2 class="mb-0 fw-bold">Admin Panel</h2>
                            <p class="text-muted mb-0">System administration and management</p>
                        </div>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4">
                                        <div class="mb-3">
                                            <h5 class="card-title mb-0 fw-semibold">User Management</h5>
                                        </div>
                                        <p class="card-text text-muted mb-4">Manage user accounts, roles, and permissions across the learning management system.</p>
                                        <button class="btn btn-outline-primary rounded-pill px-4 fw-medium">
                                            Manage Users
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm rounded-4 h-100">
                                    <div class="card-body p-4">
                                        <div class="mb-3">
                                            <h5 class="card-title mb-0 fw-semibold">System Stats</h5>
                                        </div>
                                        <p class="card-text text-muted mb-4">View comprehensive system analytics, usage statistics, and performance metrics.</p>
                                        <button class="btn btn-outline-success rounded-pill px-4 fw-medium">
                                            View Statistics
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning border-0 rounded-4 mt-4" role="alert">
                            <div>
                                <h6 class="fw-semibold mb-1">Under Development</h6>
                                <small class="mb-0">Admin features to be implemented by Sunny</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal (Sunny's responsibility) -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold" id="loginModalLabel">Login to Continue</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="login-form">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="username" placeholder="Username" required>
                            <label for="username">Username</label>
                        </div>
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control" id="password" placeholder="Password" required>
                            <label for="password">Password</label>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg w-100 fw-semibold rounded-pill">
                            Sign In
                        </button>
                    </form>
                    <div class="text-center mt-3">
                        <small class="text-muted">Need help? <a href="#" class="text-primary text-decoration-none">Contact Support</a></small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="static/js/main.js"></script>
    <script src="static/js/api.js"></script>
    <script src="static/js/learning-activities.js"></script>
    <script src="static/js/genai.js"></script>
    
    <!-- Additional event handlers for activity buttons -->
    <script>
    // Disable browser translation
    document.documentElement.setAttribute('translate', 'no');
    document.documentElement.setAttribute('class', 'notranslate');
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Setting up activity button handlers...');
        
        // Update user interface with current login info
        updateUserDisplayName();
        
        // Listen for user updates from test pages
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'updateUser') {
                console.log('Received user update:', event.data);
                // Update localStorage
                localStorage.setItem('username', event.data.username);
                localStorage.setItem('user_role', event.data.role);
                // Update display
                updateUserDisplayName();
                // Refresh role-based interface if visible
                const activitiesSection = document.getElementById('activities-section');
                if (activitiesSection && !activitiesSection.classList.contains('d-none')) {
                    window.initializeRoleBasedActivities();
                }
            }
        });
        
        // Initialize role-based interface when Activities section is clicked
        setTimeout(() => {
            const activitiesLink = document.querySelector('[data-section="activities"]');
            if (activitiesLink) {
                activitiesLink.addEventListener('click', function() {
                    console.log('Activities section clicked, initializing role-based interface...');
                    setTimeout(() => {
                        window.initializeRoleBasedActivities();
                    }, 300);
                });
            }
        }, 500);
        
        // Auto-initialize if Activities section is already visible
        setTimeout(() => {
            const activitiesSection = document.getElementById('activities-section');
            if (activitiesSection && !activitiesSection.classList.contains('d-none')) {
                console.log('Activities section is already visible, auto-initializing...');
                window.initializeRoleBasedActivities();
            }
        }, 1000);
        
        // Also initialize when Activities section becomes visible
        document.addEventListener('click', function(e) {
            if (e.target.matches('[data-section="activities"]')) {
                console.log('Activities section clicked, initializing...');
                setTimeout(() => {
                    window.initializeRoleBasedActivities();
                }, 100);
            }
        });
    });
    
    // Role-based activities interface functions
    window.initializeRoleBasedActivities = function() {
        console.log('🚀 Initializing role-based activities interface...');
        
        // Check if container exists
        const container = document.getElementById('role-based-activities-content');
        if (!container) {
            console.error('❌ Container role-based-activities-content not found!');
            return;
        }
        console.log('✅ Container found:', container);
        
        // Get user role from localStorage, userInfo, or login status
        const userRole = getUserRole();
        console.log('👤 Current user role:', userRole);
        
        // Generate role-specific interface
        if (userRole === null) {
            console.log('❓ User not logged in, showing login prompt...');
            generateLoginPrompt(container);
        } else if (userRole === 'teacher') {
            console.log('🎓 Loading teacher-only interface...');
            generateTeacherOnlyInterface(container);
        } else if (userRole === 'student') {
            console.log('🎒 Loading student-only interface...');
            generateStudentOnlyInterface(container);
                    } else {
            console.log('❓ Unknown role, showing login prompt...');
            generateLoginPrompt(container);
        }
        
        console.log('✅ Role-based activities interface initialization complete!');
    }
    
    // Generate teacher-only interface
    function generateTeacherOnlyInterface(container) {
        container.innerHTML = 
            '<div class="container-fluid">' +
                '<div class="text-center mb-5">' +
                    '<h2 class="mb-3 fw-bold">Learning Activities</h2>' +
                    '<p class="text-muted">Welcome, Teacher! Access your management tools below.</p>' +
                    '<div class="badge bg-success fs-6 px-3 py-2">Teacher Mode</div>' +
                '</div>' +
                
                '<div class="row justify-content-center">' +
                    '<div class="col-lg-8">' +
                        '<div class="row g-4">' +
                            // 只显示Teacher管理按钮
                            '<div class="col-md-6 offset-md-3">' +
                                '<div class="card border-0 shadow-sm rounded-4 h-100" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">' +
                                    '<div class="card-body text-white p-4 d-flex flex-column text-center">' +
                                        '<div class="mb-3">' +
                                            '<i class="bi bi-person-gear display-1"></i>' +
                                        '</div>' +
                                        '<h4 class="card-title fw-bold mb-3">Teacher Management</h4>' +
                                        '<p class="card-text mb-4">Manage learning activities, view student submissions, create quizzes and grading</p>' +
                                        '<div class="mt-auto">' +
                                            '<a href="teacher-activities.html" class="btn btn-light btn-lg rounded-pill px-4 fw-semibold">' +
                                                '<i class="bi bi-arrow-right-circle"></i> Enter Teacher Management' +
                                            '</a>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        
                        // Teacher功能说明
                        '<div class="row mt-5">' +
                            '<div class="col-12">' +
                                '<div class="card border-0 shadow-sm rounded-4">' +
                                    '<div class="card-body p-4">' +
                                        '<h5 class="card-title mb-3 text-center"><i class="bi bi-info-circle text-primary"></i> Teacher Features</h5>' +
                                        '<div class="row">' +
                                            '<div class="col-md-6">' +
                                                '<ul class="list-unstyled">' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> Create and manage polls</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> Create and manage quizzes</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> Create and manage word cloud activities</li>' +
                                                '</ul>' +
                                            '</div>' +
                                            '<div class="col-md-6">' +
                                                '<ul class="list-unstyled">' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> Create and manage short answers</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> View student submissions and grading</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-success"></i> Analytics and reporting</li>' +
                                                '</ul>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
    }
    
    // Generate student-only interface
    function generateStudentOnlyInterface(container) {
        container.innerHTML = 
            '<div class="container-fluid">' +
                '<div class="text-center mb-5">' +
                    '<h2 class="mb-3 fw-bold">Learning Activities</h2>' +
                    '<p class="text-muted">Welcome, Student! Access your learning activities below.</p>' +
                    '<div class="badge bg-primary fs-6 px-3 py-2">Student Mode</div>' +
                '</div>' +
                
                '<div class="row justify-content-center">' +
                    '<div class="col-lg-8">' +
                        '<div class="row g-4">' +
                            // 只显示Student活动按钮
                            '<div class="col-md-6 offset-md-3">' +
                                '<div class="card border-0 shadow-sm rounded-4 h-100" style="background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);">' +
                                    '<div class="card-body text-white p-4 d-flex flex-column text-center">' +
                                        '<div class="mb-3">' +
                                            '<i class="bi bi-person-check display-1"></i>' +
                                        '</div>' +
                                        '<h4 class="card-title fw-bold mb-3">Student Activities</h4>' +
                                        '<p class="card-text mb-4">Participate in learning activities, submit assignments, answer quizzes and surveys</p>' +
                                        '<div class="mt-auto">' +
                                            '<a href="student-activities.html" class="btn btn-light btn-lg rounded-pill px-4 fw-semibold">' +
                                                '<i class="bi bi-arrow-right-circle"></i> Enter Student Activities' +
                                            '</a>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        
                        // Student功能说明
                        '<div class="row mt-5">' +
                            '<div class="col-12">' +
                                '<div class="card border-0 shadow-sm rounded-4">' +
                                    '<div class="card-body p-4">' +
                                        '<h5 class="card-title mb-3 text-center"><i class="bi bi-info-circle text-primary"></i> Student Features</h5>' +
                                        '<div class="row">' +
                                            '<div class="col-md-6">' +
                                                '<ul class="list-unstyled">' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> Participate in poll voting</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> Participate in quiz answering</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> Submit word cloud vocabulary</li>' +
                                                '</ul>' +
                                            '</div>' +
                                            '<div class="col-md-6">' +
                                                '<ul class="list-unstyled">' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> Answer short questions</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> View activity results</li>' +
                                                    '<li class="mb-2"><i class="bi bi-check-circle text-primary"></i> Track your progress</li>' +
                                                '</ul>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
    }
    
    // Generate login prompt for users without role
    function generateLoginPrompt(container) {
        container.innerHTML = 
            '<div class="container-fluid">' +
                '<div class="text-center py-5">' +
                    '<div class="mb-4">' +
                        '<i class="bi bi-person-circle text-muted" style="font-size: 4rem;"></i>' +
                    '</div>' +
                    '<h2 class="mb-3 fw-bold">Please Login First</h2>' +
                    '<p class="text-muted mb-4">You need to login to access learning activities.</p>' +
                    
                    '<div class="row justify-content-center">' +
                        '<div class="col-md-6">' +
                            '<div class="alert alert-info">' +
                                '<h6><i class="bi bi-info-circle"></i> Demo Accounts</h6>' +
                                '<p class="mb-2"><strong>Teacher:</strong> <code>teacher1 / password123</code></p>' +
                                '<p class="mb-0"><strong>Student:</strong> <code>student1 / password123</code></p>' +
                            '</div>' +
                            '<a href="/login.html" class="btn btn-primary btn-lg rounded-pill px-4">' +
                                '<i class="bi bi-box-arrow-in-right"></i> Go to Login' +
                            '</a>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
    }
    
    function getUserRole() {
        console.log('🔍 Getting user role...');
        
        // Try to get role from localStorage
        let role = localStorage.getItem('user_role');
        console.log('📝 Role from localStorage:', role);
        
        // If no role found, try to get from userInfo
        if (!role) {
            const userInfo = localStorage.getItem('userInfo');
            console.log('📝 UserInfo from localStorage:', userInfo);
            if (userInfo) {
                try {
                    const parsed = JSON.parse(userInfo);
                    role = parsed.role;
                    console.log('📝 Role from userInfo:', role);
                    // Also save to user_role for future use
                    if (role) {
                        localStorage.setItem('user_role', role);
                    }
                } catch (e) {
                    console.warn('Failed to parse userInfo:', e);
                }
            }
        }
        
        // If still no role, try to get from username pattern
        if (!role) {
            const username = localStorage.getItem('username');
            console.log('📝 Username from localStorage:', username);
            if (username) {
                const lowerUsername = username.toLowerCase();
                // Check for teacher patterns
                if (lowerUsername.includes('teacher') || 
                    lowerUsername.includes('prof') || 
                    lowerUsername.includes('dr.') ||
                    lowerUsername.includes('instructor') ||
                    lowerUsername.includes('faculty')) {
                    role = 'teacher';
                    console.log('📝 Role inferred from username: teacher');
                } 
                // Check for student patterns
                else if (lowerUsername.includes('student') || 
                         lowerUsername.includes('alice') ||
                         lowerUsername.includes('bob') ||
                         lowerUsername.includes('charlie') ||
                         lowerUsername.includes('wang') ||
                         lowerUsername.includes('chen') ||
                         lowerUsername.includes('li')) {
                    role = 'student';
                    console.log('📝 Role inferred from username: student');
                }
                // Check if username starts with common teacher prefixes
                else if (lowerUsername.startsWith('prof.') || 
                         lowerUsername.startsWith('dr.') ||
                         lowerUsername.startsWith('teacher')) {
                    role = 'teacher';
                    console.log('📝 Role inferred from username prefix: teacher');
                }
            }
        }
        
        // Check if user is logged in (has access token)
        const hasToken = localStorage.getItem('access_token');
        console.log('🔑 Access token exists:', !!hasToken);
        
        if (!hasToken) {
            console.log('❌ No access token found, user not logged in');
            return null; // Return null if not logged in
        }
        
        // Default to student if logged in but no specific role found
        const finalRole = role || 'student';
        console.log('✅ Final role determined:', finalRole);
        return finalRole;
    }
    
    // Update user display name in navbar
    function updateUserDisplayName() {
        const userNameEl = document.getElementById('user-name');
        if (userNameEl) {
            // Try to get username from localStorage
            let displayName = localStorage.getItem('username');
            
            // If no username, try to get from userInfo
            if (!displayName) {
                const userInfo = localStorage.getItem('userInfo');
                if (userInfo) {
                    try {
                        const parsed = JSON.parse(userInfo);
                        displayName = parsed.name || parsed.username;
                    } catch (e) {
                        console.warn('Failed to parse userInfo for display name:', e);
                    }
                }
            }
            
            // Update the display
            if (displayName) {
                userNameEl.textContent = displayName;
                console.log('✅ Updated display name to:', displayName);
            } else {
                userNameEl.textContent = 'User';
                console.log('⚠️ No username found, using default');
            }
        }
    }
    </script>
</body>
</html>