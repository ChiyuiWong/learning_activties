<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教师系统调试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>教师系统调试</h2>
        <div id="debug-info" class="mt-3">
            <p>正在检查系统状态...</p>
        </div>
        <div id="test-results" class="mt-3"></div>
    </div>

    <script>
        // 简化的API客户端
        class SimpleAPIClient {
            constructor() {
                this.baseURL = 'http://127.0.0.1:5001/api';
            }

            async get(endpoint) {
                try {
                    const response = await fetch(`${this.baseURL}${endpoint}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', async function() {
            const debugInfo = document.getElementById('debug-info');
            const testResults = document.getElementById('test-results');
            
            try {
                debugInfo.innerHTML = '<p class="text-info">正在初始化API客户端...</p>';
                const api = new SimpleAPIClient();
                
                debugInfo.innerHTML = '<p class="text-info">正在测试API连接...</p>';
                
                // 测试各个API端点
                const tests = [
                    { name: '投票API', endpoint: '/learning/polls/?course_id=COMP5241' },
                    { name: '测验API', endpoint: '/learning/quizzes/?course_id=COMP5241' },
                    { name: '短答题API', endpoint: '/learning/shortanswers/?course_id=COMP5241' },
                    { name: '词云API', endpoint: '/learning/wordclouds/?course_id=COMP5241' }
                ];
                
                let results = '<h4>API测试结果:</h4>';
                
                for (const test of tests) {
                    try {
                        debugInfo.innerHTML = `<p class="text-info">正在测试 ${test.name}...</p>`;
                        const data = await api.get(test.endpoint);
                        results += `<div class="alert alert-success">✅ ${test.name}: 成功 (${Array.isArray(data) ? data.length : 'N/A'} 项数据)</div>`;
                    } catch (error) {
                        results += `<div class="alert alert-danger">❌ ${test.name}: 失败 - ${error.message}</div>`;
                    }
                }
                
                testResults.innerHTML = results;
                debugInfo.innerHTML = '<p class="text-success">测试完成！</p>';
                
            } catch (error) {
                debugInfo.innerHTML = `<p class="text-danger">初始化失败: ${error.message}</p>`;
                console.error('Initialization error:', error);
            }
        });
    </script>
</body>
</html>

